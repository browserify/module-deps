var through = require('through2');
var fs = require('fs');
var path = require('path');

module.exports = function (file, opts) {
    var bufs = [];
    return through(write, end);
    
    function write (buf, enc, next) {
        if (!Buffer.isBuffer(buf)) buf = Buffer(buf);
        bufs.push(buf);
        next();
    }
    
    function end () {
        var str = Buffer.concat(bufs).toString('utf8');
        var filepath = path.resolve(opts.packageDir, opts.dir, 'hhh-value');
        var numstr = fs.readFileSync(filepath, 'utf8').trim();
        this.push(str.replace(/HHH/g, numstr));
        this.push(null);
    }
};
